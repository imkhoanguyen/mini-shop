<p-toast></p-toast>

<div class="row align-items-center mb-3">
  <div class="col">
    <input
      type="text"
      [(ngModel)]="searchString"
      (input)="onSearch()"
      pInputText
      placeholder="Tìm kiếm..."
      class="w-100"
    />
  </div>
  <div class="col-auto">
    <p-dropdown
      [options]="pageSizeOptions"
      [(ngModel)]="pageSize"
      optionLabel="label"
      placeholder="Số lượng trang"
      class="p-dropdown-sm"
      (onChange)="onPageSizeChange($event.value)"
    ></p-dropdown>
  </div>
  <div class="col-auto">
    <p-button
      label="Thêm Sản phẩm"
      icon="pi pi-plus"
      size="large"
      severity="success"
      class="ml-2"
      (click)="addProduct()"
    ></p-button>
  </div>
</div>

<p-table
  [value]="paginatedProduct"
  dataKey="id"
  [tableStyle]="{ 'min-width': '60rem' }"
  [expandedRowKeys]="expandedRows"
  (onRowExpand)="onRowExpand($event)"
  (onRowCollapse)="onRowCollapse($event)"
>
  <ng-template pTemplate="header">
    <tr>
      <th style="width: 5rem"></th>
      <th pSortableColumn="name">
        Tên
        <p-sortIcon field="name" />
      </th>
      <th>Hình ảnh</th>
      <th pSortableColumn="description">
        Mô tả
        <p-sortIcon field="description" />
      </th>
      <th pSortableColumn="created">
        Ngày tạo
        <p-sortIcon field="created" />
      </th>
      <th pSortableColumn="category">
        Danh mục
        <p-sortIcon field="category" />
      </th>
      <th pSortableColumn="inventoryStatus">
        Status
        <p-sortIcon field="inventoryStatus" />
      </th>
      <th>Action</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-product let-expanded="expanded">
    <tr>
      <td>
        <p-button
          type="button"
          pRipple
          [pRowToggler]="product"
          [text]="true"
          [rounded]="true"
          [plain]="true"
          [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
        ></p-button>
      </td>
      <td>{{ product.name }}</td>
      <td>
        <ng-container *ngFor="let imageUrl of product.imageUrls">
          <img
            [src]="imageUrl.url"
            alt="Hình ảnh sản phẩm"
            class="rounded img-thumbnail"
            style="width: 50px; height: 50px; margin-right: 5px;"
          />
        </ng-container>
      </td>
      <td>{{ product.description }}</td>
      <td>{{ product.created | date: 'dd/MM/yyyy' }}</td>
      <td>
        <ng-container *ngFor="let categoryId of product.categoryIds">
          <span class="badge bg-primary">{{ categoryId }}</span>
        </ng-container>
      </td>
      <td>
        <p-inputSwitch [(ngModel)]="product.status"></p-inputSwitch>
      </td>
      <td>
        <p-button
          icon="pi pi-file-edit"
          [rounded]="true"
          severity="info"
          class="mr-1"
          (onClick)="editProduct(product)"
        ></p-button>
        <p-button
          icon="pi pi-trash"
          [rounded]="true"
          severity="danger"
          (onClick)="deleteProduct(product)"
        ></p-button>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="rowexpansion" let-product>
    <tr>
      <td colspan="8">
        <div class="p-3">
          <p-table [value]="product.variants" dataKey="id">
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="id">Id Thể loại <p-sortIcon field="id" /></th>
                <th pSortableColumn="price">Giá <p-sortIcon field="price" /></th>
                <th pSortableColumn="priceSell">Giá giảm <p-sortIcon field="priceSell" /></th>
                <th pSortableColumn="quantity">Số lượng <p-sortIcon field="quantity" /></th>
                <th pSortableColumn="sizeId">Kích thước <p-sortIcon field="sizeId" /></th>
                <th pSortableColumn="colorId">Màu sắc <p-sortIcon field="colorId" /></th>
                <th style="width: 4rem"></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-variant>
              <tr>
                <td>{{ variant.id }}</td>
                <td>{{ variant.price | currency: 'VND' }}</td>
                <td>{{ variant.priceSell | currency: 'VND' }}</td>
                <td>{{ variant.quantity }}</td>
                <td>{{ variant.sizeId }}</td>
                <td>{{ variant.colorId }}</td>
                <td>
                  <p-button
                    type="button"
                    icon="pi pi-search"
                    class="p-button-sm"
                  ></p-button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="7">Không có biến thể nào.</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>
<p-paginator
  (onPageChange)="onPageChange($event)"
  [first]="pageNumber"
  [rows]="pageSize"
  [totalRecords]="120"
/>
